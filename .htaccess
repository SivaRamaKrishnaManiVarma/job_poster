# ============================================
# Job Portal - Professional .htaccess
# ============================================

# Enable Rewrite Engine
RewriteEngine On
RewriteBase /job_poster/

# ============================================
# CLEAN URLs - Job Details
# ============================================
# Before: /job-details.php?slug=ssc-grade-c-stenographer-2026
# After:  /jobs/ssc-grade-c-stenographer-2026

# Rule 1: Redirect old URLs to new clean URLs (301 permanent)
RewriteCond %{THE_REQUEST} /job-details\.php\?slug=([^&\s]+) [NC]
RewriteRule ^ jobs/%1? [R=301,L]

# Rule 2: Handle clean URLs internally
# IMPORTANT: Only match slug patterns, not actual files/folders
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^jobs/([a-z0-9-]+)/?$ job-details.php?slug=$1 [L,QSA]

# ============================================
# CLEAN URLs - Categories (Optional)
# ============================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^category/([a-z0-9-]+)/?$ index.php?category=$1 [L,QSA]

# ============================================
# Remove Trailing Slashes
# ============================================
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# ============================================
# Security Settings
# ============================================

# Prevent directory browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(config\.php|functions\.php|database\.sql|.*\.env|composer\.json|package\.json)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect includes folder
RedirectMatch 403 ^/job_poster/includes/.*$

# Block access to hidden files (like .git, .htaccess)
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# ============================================
# Performance Optimization
# ============================================

# Enable GZIP Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ============================================
# Error Pages (Optional)
# ============================================
# ErrorDocument 404 /job_poster/404.php
# ErrorDocument 403 /job_poster/403.php
# ErrorDocument 500 /job_poster/500.php

# ============================================
# Force HTTPS (Uncomment when going live)
# ============================================
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
